<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Autentificare ProducÈ›ie - AutoConta</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background: #d4edda; border-color: #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border-color: #f5c6cb; color: #721c24; }
        .info { background: #d1ecf1; border-color: #bee5eb; color: #0c5460; }
        .warning { background: #fff3cd; border-color: #ffeaa7; color: #856404; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .log { background: #f8f9fa; padding: 10px; border-radius: 4px; font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto; margin: 10px 0; white-space: pre-wrap; }
        .step { margin: 10px 0; padding: 10px; background: #f8f9fa; border-left: 4px solid #007bff; }
        .step.completed { border-left-color: #28a745; background: #d4edda; }
        .step.failed { border-left-color: #dc3545; background: #f8d7da; }
        .step.pending { border-left-color: #ffc107; background: #fff3cd; }
        iframe { width: 100%; height: 600px; border: 1px solid #ddd; border-radius: 4px; }
        .tabs { display: flex; margin-bottom: 20px; }
        .tab { padding: 10px 20px; background: #f8f9fa; border: 1px solid #ddd; cursor: pointer; margin-right: 5px; }
        .tab.active { background: #007bff; color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Debug Autentificare ProducÈ›ie - AutoConta</h1>
        <p>Acest tool monitorizeazÄƒ pas cu pas fluxul de autentificare Ã®n producÈ›ie.</p>

        <div class="tabs">
            <div class="tab active" onclick="showTab('overview')">Prezentare GeneralÄƒ</div>
            <div class="tab" onclick="showTab('debug')">Debug Live</div>
            <div class="tab" onclick="showTab('comparison')">ComparaÈ›ie Local vs ProducÈ›ie</div>
            <div class="tab" onclick="showTab('solutions')">SoluÈ›ii</div>
        </div>

        <div id="overview" class="tab-content active">
            <div class="debug-section info">
                <h3>ğŸ“Š InformaÈ›ii Mediu Curent</h3>
                <div id="environment-info">
                    <p><strong>URL:</strong> <span id="current-url"></span></p>
                    <p><strong>Hostname:</strong> <span id="hostname"></span></p>
                    <p><strong>Mediu detectat:</strong> <span id="environment"></span></p>
                    <p><strong>Timestamp:</strong> <span id="timestamp"></span></p>
                </div>
            </div>

            <div class="debug-section">
                <h3>ğŸ”„ PaÈ™i de Debugging</h3>
                <div id="debug-steps">
                    <div class="step pending" id="step-1">
                        <strong>Pasul 1:</strong> VerificÄƒ aplicaÈ›ia de producÈ›ie
                        <div id="step-1-result"></div>
                    </div>
                    <div class="step pending" id="step-2">
                        <strong>Pasul 2:</strong> TesteazÄƒ autentificarea Google
                        <div id="step-2-result"></div>
                    </div>
                    <div class="step pending" id="step-3">
                        <strong>Pasul 3:</strong> MonitorizeazÄƒ redirecÈ›ionarea
                        <div id="step-3-result"></div>
                    </div>
                    <div class="step pending" id="step-4">
                        <strong>Pasul 4:</strong> VerificÄƒ starea store-ului
                        <div id="step-4-result"></div>
                    </div>
                </div>
            </div>

            <div class="debug-section">
                <h3>ğŸš€ AcÈ›iuni Rapide</h3>
                <button onclick="openProductionApp()">Deschide AplicaÈ›ia ProducÈ›ie</button>
                <button onclick="openProductionWithDebug()">Deschide cu Console Debug</button>
                <button onclick="clearBrowserCache()">InstrucÈ›iuni Clear Cache</button>
                <button onclick="runFullDiagnostic()">RuleazÄƒ Diagnostic Complet</button>
            </div>
        </div>

        <div id="debug" class="tab-content">
            <div class="debug-section">
                <h3>ğŸ” Monitorizare Live</h3>
                <p>Deschide aplicaÈ›ia de producÈ›ie Ã®n iframe pentru monitorizare:</p>
                <iframe id="production-iframe" src="https://autoconta.lovable.app"></iframe>
            </div>
        </div>

        <div id="comparison" class="tab-content">
            <div class="debug-section">
                <h3>âš–ï¸ ComparaÈ›ie Medii</h3>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: #f8f9fa;">
                        <th style="border: 1px solid #ddd; padding: 10px;">Aspect</th>
                        <th style="border: 1px solid #ddd; padding: 10px;">Localhost</th>
                        <th style="border: 1px solid #ddd; padding: 10px;">ProducÈ›ie</th>
                        <th style="border: 1px solid #ddd; padding: 10px;">Status</th>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 10px;">URL</td>
                        <td style="border: 1px solid #ddd; padding: 10px;">http://localhost:8080</td>
                        <td style="border: 1px solid #ddd; padding: 10px;">https://autoconta.lovable.app</td>
                        <td style="border: 1px solid #ddd; padding: 10px;">âœ… OK</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 10px;">Autentificare</td>
                        <td style="border: 1px solid #ddd; padding: 10px;">âœ… FuncÈ›ioneazÄƒ</td>
                        <td style="border: 1px solid #ddd; padding: 10px;">âŒ Nu funcÈ›ioneazÄƒ</td>
                        <td style="border: 1px solid #ddd; padding: 10px;">ğŸ” InvestigÄƒm</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 10px;">Redirect dupÄƒ auth</td>
                        <td style="border: 1px solid #ddd; padding: 10px;">âœ… Dashboard</td>
                        <td style="border: 1px solid #ddd; padding: 10px;">âŒ RÄƒmÃ¢ne pe /auth/callback</td>
                        <td style="border: 1px solid #ddd; padding: 10px;">ğŸ” InvestigÄƒm</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 10px;">Supabase Config</td>
                        <td style="border: 1px solid #ddd; padding: 10px;">âœ… AcelaÈ™i</td>
                        <td style="border: 1px solid #ddd; padding: 10px;">âœ… AcelaÈ™i</td>
                        <td style="border: 1px solid #ddd; padding: 10px;">âœ… OK</td>
                    </tr>
                </table>
            </div>
        </div>

        <div id="solutions" class="tab-content">
            <div class="debug-section">
                <h3>ğŸ’¡ SoluÈ›ii Posibile</h3>
                
                <div class="debug-section warning">
                    <h4>ğŸ” Problema IdentificatÄƒ</h4>
                    <p>AplicaÈ›ia funcÈ›ioneazÄƒ perfect Ã®n localhost dar nu Ã®n producÈ›ie. Posibile cauze:</p>
                    <ul>
                        <li><strong>Cache Browser:</strong> Versiunea veche a aplicaÈ›iei Ã®n cache</li>
                        <li><strong>Deployment Delay:</strong> ModificÄƒrile nu s-au propagat Ã®ncÄƒ</li>
                        <li><strong>Environment Variables:</strong> DiferenÈ›e Ã®n configuraÈ›ia de producÈ›ie</li>
                        <li><strong>Store Sync Issue:</strong> Probleme de sincronizare Ã®ntre sesiune È™i store</li>
                    </ul>
                </div>

                <div class="debug-section info">
                    <h4>ğŸ› ï¸ SoluÈ›ii de Ãncercat</h4>
                    <ol>
                        <li><strong>Clear Cache Complet:</strong>
                            <ul>
                                <li>Deschide DevTools (F12)</li>
                                <li>Click dreapta pe butonul Refresh</li>
                                <li>SelecteazÄƒ "Empty Cache and Hard Reload"</li>
                            </ul>
                        </li>
                        <li><strong>VerificÄƒ Network Tab:</strong>
                            <ul>
                                <li>Deschide DevTools â†’ Network</li>
                                <li>ÃncearcÄƒ autentificarea</li>
                                <li>VerificÄƒ request-urile cÄƒtre Supabase</li>
                            </ul>
                        </li>
                        <li><strong>VerificÄƒ Console Logs:</strong>
                            <ul>
                                <li>Deschide DevTools â†’ Console</li>
                                <li>CautÄƒ mesajele de debug din AuthCallback</li>
                                <li>VerificÄƒ dacÄƒ authUser se seteazÄƒ Ã®n store</li>
                            </ul>
                        </li>
                        <li><strong>TesteazÄƒ Ã®n Incognito:</strong>
                            <ul>
                                <li>Deschide o fereastrÄƒ incognito</li>
                                <li>NavigheazÄƒ la https://autoconta.lovable.app</li>
                                <li>ÃncearcÄƒ autentificarea</li>
                            </ul>
                        </li>
                    </ol>
                </div>

                <div class="debug-section success">
                    <h4>âœ… VerificÄƒri Completate</h4>
                    <ul>
                        <li>âœ… Codul a fost committat È™i pushat pe main</li>
                        <li>âœ… Rutele sunt configurate corect Ã®n App.tsx</li>
                        <li>âœ… AuthCallback.tsx existÄƒ È™i are logica corectÄƒ</li>
                        <li>âœ… ConfiguraÈ›ia Supabase este aceeaÈ™i pentru ambele medii</li>
                        <li>âœ… Detectarea mediului funcÈ›ioneazÄƒ corect</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="debug-section">
            <h3>ğŸ“ Log Debug</h3>
            <div id="debug-log" class="log"></div>
        </div>
    </div>

    <script>
        // Initialize
        document.getElementById('current-url').textContent = window.location.href;
        document.getElementById('hostname').textContent = window.location.hostname;
        document.getElementById('environment').textContent = window.location.hostname === 'localhost' ? 'Local Development' : 'Production';
        document.getElementById('timestamp').textContent = new Date().toLocaleString();

        function log(message, type = 'info') {
            const logDiv = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}\n`;
            logDiv.textContent += logEntry;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[DEBUG] ${message}`);
        }

        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function openProductionApp() {
            log('Deschid aplicaÈ›ia de producÈ›ie Ã®n tab nou');
            window.open('https://autoconta.lovable.app', '_blank');
        }

        function openProductionWithDebug() {
            log('Deschid aplicaÈ›ia de producÈ›ie cu instrucÈ›iuni debug');
            const newWindow = window.open('https://autoconta.lovable.app', '_blank');
            
            setTimeout(() => {
                alert(`InstrucÈ›iuni Debug:
1. Deschide DevTools (F12)
2. Mergi la tab-ul Console
3. ÃncearcÄƒ sÄƒ te autentifici cu Google
4. UrmÄƒreÈ™te mesajele din console:
   - "ğŸ”„ Processing auth callback..."
   - "âœ… User authenticated successfully"
   - "â³ Waiting for authUser to be set..."
   - "âœ… AuthUser set in store, navigating to dashboard"

DacÄƒ nu vezi ultimul mesaj, problema este Ã®n sincronizarea store-ului.`);
            }, 2000);
        }

        function clearBrowserCache() {
            alert(`InstrucÈ›iuni Clear Cache:

1. Deschide https://autoconta.lovable.app
2. Deschide DevTools (F12)
3. Click dreapta pe butonul Refresh din browser
4. SelecteazÄƒ "Empty Cache and Hard Reload"
5. SAU foloseÈ™te Ctrl+Shift+R (Windows) / Cmd+Shift+R (Mac)

Alternativ:
1. Deschide o fereastrÄƒ Incognito/Private
2. NavigheazÄƒ la https://autoconta.lovable.app
3. ÃncearcÄƒ autentificarea`);
        }

        async function runFullDiagnostic() {
            log('Ãncep diagnostic complet...');
            
            // Step 1
            updateStep(1, 'pending', 'VerificÄƒm aplicaÈ›ia de producÈ›ie...');
            try {
                const response = await fetch('https://autoconta.lovable.app', { method: 'HEAD', mode: 'no-cors' });
                updateStep(1, 'completed', 'AplicaÈ›ia de producÈ›ie este accesibilÄƒ');
            } catch (error) {
                updateStep(1, 'failed', `Eroare: ${error.message}`);
                return;
            }

            // Step 2
            updateStep(2, 'pending', 'VerificÄƒm rutele...');
            try {
                const routes = ['/auth/callback', '/dashboard'];
                for (const route of routes) {
                    await fetch(`https://autoconta.lovable.app${route}`, { method: 'HEAD', mode: 'no-cors' });
                }
                updateStep(2, 'completed', 'Rutele sunt accesibile');
            } catch (error) {
                updateStep(2, 'failed', `Eroare la verificarea rutelor: ${error.message}`);
            }

            // Step 3
            updateStep(3, 'pending', 'VerificÄƒm Supabase...');
            try {
                await fetch('https://ytjdvoyyiapkyzjrjllp.supabase.co/rest/v1/', { method: 'HEAD', mode: 'no-cors' });
                updateStep(3, 'completed', 'Supabase este accesibil');
            } catch (error) {
                updateStep(3, 'failed', `Eroare Supabase: ${error.message}`);
            }

            // Step 4
            updateStep(4, 'completed', 'Diagnostic complet. VerificÄƒ console logs Ã®n aplicaÈ›ia de producÈ›ie.');
            
            log('Diagnostic complet finalizat. UrmÄƒtorul pas: testeazÄƒ manual Ã®n producÈ›ie.');
        }

        function updateStep(stepNumber, status, message) {
            const step = document.getElementById(`step-${stepNumber}`);
            const result = document.getElementById(`step-${stepNumber}-result`);
            
            step.className = `step ${status}`;
            result.textContent = message;
            
            log(`Pasul ${stepNumber}: ${message}`);
        }

        // Auto-start diagnostic
        window.onload = function() {
            log('Debug tool Ã®ncÄƒrcat');
            setTimeout(runFullDiagnostic, 1000);
        };
    </script>
</body>
</html>