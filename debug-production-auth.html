<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Autentificare Producție - AutoConta</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background: #d4edda; border-color: #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border-color: #f5c6cb; color: #721c24; }
        .info { background: #d1ecf1; border-color: #bee5eb; color: #0c5460; }
        .warning { background: #fff3cd; border-color: #ffeaa7; color: #856404; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .log { background: #f8f9fa; padding: 10px; border-radius: 4px; font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto; margin: 10px 0; white-space: pre-wrap; }
        .step { margin: 10px 0; padding: 10px; background: #f8f9fa; border-left: 4px solid #007bff; }
        .step.completed { border-left-color: #28a745; background: #d4edda; }
        .step.failed { border-left-color: #dc3545; background: #f8d7da; }
        .step.pending { border-left-color: #ffc107; background: #fff3cd; }
        iframe { width: 100%; height: 600px; border: 1px solid #ddd; border-radius: 4px; }
        .tabs { display: flex; margin-bottom: 20px; }
        .tab { padding: 10px 20px; background: #f8f9fa; border: 1px solid #ddd; cursor: pointer; margin-right: 5px; }
        .tab.active { background: #007bff; color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔍 Debug Autentificare Producție - AutoConta</h1>
        <p>Acest tool monitorizează pas cu pas fluxul de autentificare în producție.</p>

        <div class="tabs">
            <div class="tab active" onclick="showTab('overview')">Prezentare Generală</div>
            <div class="tab" onclick="showTab('debug')">Debug Live</div>
            <div class="tab" onclick="showTab('comparison')">Comparație Local vs Producție</div>
            <div class="tab" onclick="showTab('solutions')">Soluții</div>
        </div>

        <div id="overview" class="tab-content active">
            <div class="debug-section info">
                <h3>📊 Informații Mediu Curent</h3>
                <div id="environment-info">
                    <p><strong>URL:</strong> <span id="current-url"></span></p>
                    <p><strong>Hostname:</strong> <span id="hostname"></span></p>
                    <p><strong>Mediu detectat:</strong> <span id="environment"></span></p>
                    <p><strong>Timestamp:</strong> <span id="timestamp"></span></p>
                </div>
            </div>

            <div class="debug-section">
                <h3>🔄 Pași de Debugging</h3>
                <div id="debug-steps">
                    <div class="step pending" id="step-1">
                        <strong>Pasul 1:</strong> Verifică aplicația de producție
                        <div id="step-1-result"></div>
                    </div>
                    <div class="step pending" id="step-2">
                        <strong>Pasul 2:</strong> Testează autentificarea Google
                        <div id="step-2-result"></div>
                    </div>
                    <div class="step pending" id="step-3">
                        <strong>Pasul 3:</strong> Monitorizează redirecționarea
                        <div id="step-3-result"></div>
                    </div>
                    <div class="step pending" id="step-4">
                        <strong>Pasul 4:</strong> Verifică starea store-ului
                        <div id="step-4-result"></div>
                    </div>
                </div>
            </div>

            <div class="debug-section">
                <h3>🚀 Acțiuni Rapide</h3>
                <button onclick="openProductionApp()">Deschide Aplicația Producție</button>
                <button onclick="openProductionWithDebug()">Deschide cu Console Debug</button>
                <button onclick="clearBrowserCache()">Instrucțiuni Clear Cache</button>
                <button onclick="runFullDiagnostic()">Rulează Diagnostic Complet</button>
            </div>
        </div>

        <div id="debug" class="tab-content">
            <div class="debug-section">
                <h3>🔍 Monitorizare Live</h3>
                <p>Deschide aplicația de producție în iframe pentru monitorizare:</p>
                <iframe id="production-iframe" src="https://autoconta.lovable.app"></iframe>
            </div>
        </div>

        <div id="comparison" class="tab-content">
            <div class="debug-section">
                <h3>⚖️ Comparație Medii</h3>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: #f8f9fa;">
                        <th style="border: 1px solid #ddd; padding: 10px;">Aspect</th>
                        <th style="border: 1px solid #ddd; padding: 10px;">Localhost</th>
                        <th style="border: 1px solid #ddd; padding: 10px;">Producție</th>
                        <th style="border: 1px solid #ddd; padding: 10px;">Status</th>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 10px;">URL</td>
                        <td style="border: 1px solid #ddd; padding: 10px;">http://localhost:8080</td>
                        <td style="border: 1px solid #ddd; padding: 10px;">https://autoconta.lovable.app</td>
                        <td style="border: 1px solid #ddd; padding: 10px;">✅ OK</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 10px;">Autentificare</td>
                        <td style="border: 1px solid #ddd; padding: 10px;">✅ Funcționează</td>
                        <td style="border: 1px solid #ddd; padding: 10px;">❌ Nu funcționează</td>
                        <td style="border: 1px solid #ddd; padding: 10px;">🔍 Investigăm</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 10px;">Redirect după auth</td>
                        <td style="border: 1px solid #ddd; padding: 10px;">✅ Dashboard</td>
                        <td style="border: 1px solid #ddd; padding: 10px;">❌ Rămâne pe /auth/callback</td>
                        <td style="border: 1px solid #ddd; padding: 10px;">🔍 Investigăm</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 10px;">Supabase Config</td>
                        <td style="border: 1px solid #ddd; padding: 10px;">✅ Același</td>
                        <td style="border: 1px solid #ddd; padding: 10px;">✅ Același</td>
                        <td style="border: 1px solid #ddd; padding: 10px;">✅ OK</td>
                    </tr>
                </table>
            </div>
        </div>

        <div id="solutions" class="tab-content">
            <div class="debug-section">
                <h3>💡 Soluții Posibile</h3>
                
                <div class="debug-section warning">
                    <h4>🔍 Problema Identificată</h4>
                    <p>Aplicația funcționează perfect în localhost dar nu în producție. Posibile cauze:</p>
                    <ul>
                        <li><strong>Cache Browser:</strong> Versiunea veche a aplicației în cache</li>
                        <li><strong>Deployment Delay:</strong> Modificările nu s-au propagat încă</li>
                        <li><strong>Environment Variables:</strong> Diferențe în configurația de producție</li>
                        <li><strong>Store Sync Issue:</strong> Probleme de sincronizare între sesiune și store</li>
                    </ul>
                </div>

                <div class="debug-section info">
                    <h4>🛠️ Soluții de Încercat</h4>
                    <ol>
                        <li><strong>Clear Cache Complet:</strong>
                            <ul>
                                <li>Deschide DevTools (F12)</li>
                                <li>Click dreapta pe butonul Refresh</li>
                                <li>Selectează "Empty Cache and Hard Reload"</li>
                            </ul>
                        </li>
                        <li><strong>Verifică Network Tab:</strong>
                            <ul>
                                <li>Deschide DevTools → Network</li>
                                <li>Încearcă autentificarea</li>
                                <li>Verifică request-urile către Supabase</li>
                            </ul>
                        </li>
                        <li><strong>Verifică Console Logs:</strong>
                            <ul>
                                <li>Deschide DevTools → Console</li>
                                <li>Caută mesajele de debug din AuthCallback</li>
                                <li>Verifică dacă authUser se setează în store</li>
                            </ul>
                        </li>
                        <li><strong>Testează în Incognito:</strong>
                            <ul>
                                <li>Deschide o fereastră incognito</li>
                                <li>Navighează la https://autoconta.lovable.app</li>
                                <li>Încearcă autentificarea</li>
                            </ul>
                        </li>
                    </ol>
                </div>

                <div class="debug-section success">
                    <h4>✅ Verificări Completate</h4>
                    <ul>
                        <li>✅ Codul a fost committat și pushat pe main</li>
                        <li>✅ Rutele sunt configurate corect în App.tsx</li>
                        <li>✅ AuthCallback.tsx există și are logica corectă</li>
                        <li>✅ Configurația Supabase este aceeași pentru ambele medii</li>
                        <li>✅ Detectarea mediului funcționează corect</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="debug-section">
            <h3>📝 Log Debug</h3>
            <div id="debug-log" class="log"></div>
        </div>
    </div>

    <script>
        // Initialize
        document.getElementById('current-url').textContent = window.location.href;
        document.getElementById('hostname').textContent = window.location.hostname;
        document.getElementById('environment').textContent = window.location.hostname === 'localhost' ? 'Local Development' : 'Production';
        document.getElementById('timestamp').textContent = new Date().toLocaleString();

        function log(message, type = 'info') {
            const logDiv = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}\n`;
            logDiv.textContent += logEntry;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[DEBUG] ${message}`);
        }

        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function openProductionApp() {
            log('Deschid aplicația de producție în tab nou');
            window.open('https://autoconta.lovable.app', '_blank');
        }

        function openProductionWithDebug() {
            log('Deschid aplicația de producție cu instrucțiuni debug');
            const newWindow = window.open('https://autoconta.lovable.app', '_blank');
            
            setTimeout(() => {
                alert(`Instrucțiuni Debug:
1. Deschide DevTools (F12)
2. Mergi la tab-ul Console
3. Încearcă să te autentifici cu Google
4. Urmărește mesajele din console:
   - "🔄 Processing auth callback..."
   - "✅ User authenticated successfully"
   - "⏳ Waiting for authUser to be set..."
   - "✅ AuthUser set in store, navigating to dashboard"

Dacă nu vezi ultimul mesaj, problema este în sincronizarea store-ului.`);
            }, 2000);
        }

        function clearBrowserCache() {
            alert(`Instrucțiuni Clear Cache:

1. Deschide https://autoconta.lovable.app
2. Deschide DevTools (F12)
3. Click dreapta pe butonul Refresh din browser
4. Selectează "Empty Cache and Hard Reload"
5. SAU folosește Ctrl+Shift+R (Windows) / Cmd+Shift+R (Mac)

Alternativ:
1. Deschide o fereastră Incognito/Private
2. Navighează la https://autoconta.lovable.app
3. Încearcă autentificarea`);
        }

        async function runFullDiagnostic() {
            log('Încep diagnostic complet...');
            
            // Step 1
            updateStep(1, 'pending', 'Verificăm aplicația de producție...');
            try {
                const response = await fetch('https://autoconta.lovable.app', { method: 'HEAD', mode: 'no-cors' });
                updateStep(1, 'completed', 'Aplicația de producție este accesibilă');
            } catch (error) {
                updateStep(1, 'failed', `Eroare: ${error.message}`);
                return;
            }

            // Step 2
            updateStep(2, 'pending', 'Verificăm rutele...');
            try {
                const routes = ['/auth/callback', '/dashboard'];
                for (const route of routes) {
                    await fetch(`https://autoconta.lovable.app${route}`, { method: 'HEAD', mode: 'no-cors' });
                }
                updateStep(2, 'completed', 'Rutele sunt accesibile');
            } catch (error) {
                updateStep(2, 'failed', `Eroare la verificarea rutelor: ${error.message}`);
            }

            // Step 3
            updateStep(3, 'pending', 'Verificăm Supabase...');
            try {
                await fetch('https://ytjdvoyyiapkyzjrjllp.supabase.co/rest/v1/', { method: 'HEAD', mode: 'no-cors' });
                updateStep(3, 'completed', 'Supabase este accesibil');
            } catch (error) {
                updateStep(3, 'failed', `Eroare Supabase: ${error.message}`);
            }

            // Step 4
            updateStep(4, 'completed', 'Diagnostic complet. Verifică console logs în aplicația de producție.');
            
            log('Diagnostic complet finalizat. Următorul pas: testează manual în producție.');
        }

        function updateStep(stepNumber, status, message) {
            const step = document.getElementById(`step-${stepNumber}`);
            const result = document.getElementById(`step-${stepNumber}-result`);
            
            step.className = `step ${status}`;
            result.textContent = message;
            
            log(`Pasul ${stepNumber}: ${message}`);
        }

        // Auto-start diagnostic
        window.onload = function() {
            log('Debug tool încărcat');
            setTimeout(runFullDiagnostic, 1000);
        };
    </script>
</body>
</html>