<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Rutare »ôi Autentificare - AutoConta</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .info { color: #17a2b8; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Rutare »ôi Autentificare</h1>
        
        <div class="test-section">
            <h3>üìç Test Rutare</h3>
            <p>TesteazƒÉ comportamentul rutƒÉrii pentru diferite URL-uri:</p>
            <button class="test-button" onclick="testRoute('/dashboard')">Test /dashboard</button>
            <button class="test-button" onclick="testRoute('/settings')">Test /settings</button>
            <button class="test-button" onclick="testRoute('/business')">Test /business</button>
            <button class="test-button" onclick="testRoute('/documents')">Test /documents</button>
            <button class="test-button" onclick="testRoute('/inexistent')">Test /inexistent</button>
        </div>

        <div class="test-section">
            <h3>üîê Test Autentificare</h3>
            <p>VerificƒÉ starea de autentificare »ôi testeazƒÉ func»õiile:</p>
            <button class="test-button" onclick="checkAuthState()">VerificƒÉ Starea Auth</button>
            <button class="test-button" onclick="testGoogleAuth()">Test Google Auth</button>
            <button class="test-button" onclick="clearAuthState()">CurƒÉ»õƒÉ Starea Auth</button>
        </div>

        <div class="test-section">
            <h3>üóÑÔ∏è Test Baza de Date</h3>
            <p>TesteazƒÉ conectivitatea cu Supabase:</p>
            <button class="test-button" onclick="testSupabaseConnection()">Test Conexiune</button>
            <button class="test-button" onclick="testUserProfile()">Test Profil Utilizator</button>
        </div>

        <div class="test-section">
            <h3>üìã Log-uri</h3>
            <div id="logs" class="log"></div>
            <button class="test-button" onclick="clearLogs()">CurƒÉ»õƒÉ Log-uri</button>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const logs = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}\n`;
            logs.innerHTML += `<span class="${type}">${logEntry}</span>`;
            logs.scrollTop = logs.scrollHeight;
            console.log(message);
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
        }

        function testRoute(path) {
            log(`üß≠ Testez rutarea cƒÉtre: ${path}`, 'info');
            
            // VerificƒÉ starea curentƒÉ
            log(`üìç URL curent: ${window.location.href}`, 'info');
            
            // √éncearcƒÉ sƒÉ navigheze
            try {
                const newUrl = `${window.location.origin}${path}`;
                log(`üîÑ Navighez cƒÉtre: ${newUrl}`, 'info');
                
                // Deschide √Æntr-o fereastrƒÉ nouƒÉ pentru a nu pierde testul
                window.open(newUrl, '_blank');
                log(`‚úÖ FereastrƒÉ nouƒÉ deschisƒÉ pentru ${path}`, 'success');
            } catch (error) {
                log(`‚ùå Eroare la navigare: ${error.message}`, 'error');
            }
        }

        function checkAuthState() {
            log('üîç Verific√¢nd starea de autentificare...', 'info');
            
            // VerificƒÉ localStorage pentru chei Supabase
            const sbKeys = Object.keys(localStorage).filter(key => key.startsWith('sb-'));
            log(`üîë Chei Supabase √Æn localStorage: ${sbKeys.length}`, sbKeys.length > 0 ? 'success' : 'warning');
            
            // VerificƒÉ starea Zustand
            const zustandState = localStorage.getItem('autoconta-storage');
            log(`üóÑÔ∏è Stare Zustand: ${zustandState ? 'ExistƒÉ' : 'Nu existƒÉ'}`, zustandState ? 'success' : 'warning');
            
            if (zustandState) {
                try {
                    const parsed = JSON.parse(zustandState);
                    log(`üë§ Utilizator √Æn stare: ${parsed.state?.authUser?.email || 'Nu existƒÉ'}`, parsed.state?.authUser ? 'success' : 'warning');
                } catch (e) {
                    log(`‚ùå Eroare la parsarea stƒÉrii Zustand: ${e.message}`, 'error');
                }
            }
        }

        function testGoogleAuth() {
            log('üîó Testez autentificarea Google...', 'info');
            
            // VerificƒÉ configura»õia OAuth
            const currentOrigin = window.location.origin;
            log(`üåê Origin curent: ${currentOrigin}`, 'info');
            
            // SimuleazƒÉ click pe butonul Google Auth
            log('‚ö†Ô∏è Pentru testul real, acceseazƒÉ aplica»õia principalƒÉ »ôi apasƒÉ "ContinuƒÉ cu Google"', 'warning');
            log('üîÑ Sau deschide: http://localhost:8080/auth', 'info');
            
            // Deschide pagina de auth
            window.open('http://localhost:8080/auth', '_blank');
        }

        function clearAuthState() {
            log('üßπ CurƒÉ»õ√¢nd starea de autentificare...', 'info');
            
            // CurƒÉ»õƒÉ localStorage
            const keysToRemove = [];
            Object.keys(localStorage).forEach(key => {
                if (key.startsWith('sb-') || key === 'autoconta-storage') {
                    keysToRemove.push(key);
                    localStorage.removeItem(key);
                }
            });
            
            log(`üóëÔ∏è »òterse ${keysToRemove.length} chei din localStorage`, 'success');
            log('üîÑ Re√ÆncarcƒÉ aplica»õia pentru a vedea efectul', 'info');
        }

        async function testSupabaseConnection() {
            log('üîå Testez conexiunea cu Supabase...', 'info');
            
            try {
                // Test simplu de fetch cƒÉtre Supabase
                const response = await fetch('https://ytjdvoyyiapkyzjrjllp.supabase.co/rest/v1/', {
                    headers: {
                        'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl0amR2b3l5aWFwa3l6anJqbGxwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcxNzYxNDUsImV4cCI6MjA3Mjc1MjE0NX0._Er5RxJmtzYMpXMU15Pi9M-xSjJwk1gORqrZwR8nf2g'
                    }
                });
                
                if (response.ok) {
                    log('‚úÖ Conexiunea cu Supabase func»õioneazƒÉ', 'success');
                } else {
                    log(`‚ö†Ô∏è RƒÉspuns Supabase: ${response.status} ${response.statusText}`, 'warning');
                }
            } catch (error) {
                log(`‚ùå Eroare conexiune Supabase: ${error.message}`, 'error');
            }
        }

        async function testUserProfile() {
            log('üë§ Testez accesul la tabelul user_profiles...', 'info');
            
            try {
                const response = await fetch('https://ytjdvoyyiapkyzjrjllp.supabase.co/rest/v1/user_profiles?select=id&limit=1', {
                    headers: {
                        'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl0amR2b3l5aWFwa3l6anJqbGxwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcxNzYxNDUsImV4cCI6MjA3Mjc1MjE0NX0._Er5RxJmtzYMpXMU15Pi9M-xSjJwk1gORqrZwR8nf2g',
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ Tabelul user_profiles este accesibil. √énregistrƒÉri: ${data.length}`, 'success');
                } else {
                    const errorText = await response.text();
                    log(`‚ö†Ô∏è Eroare acces user_profiles: ${response.status} - ${errorText}`, 'warning');
                }
            } catch (error) {
                log(`‚ùå Eroare test user_profiles: ${error.message}`, 'error');
            }
        }

        // Ini»õializare
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ Test de rutare »ôi autentificare ini»õializat', 'success');
            log('üìç URL curent: ' + window.location.href, 'info');
            checkAuthState();
        });
    </script>
</body>
</html>